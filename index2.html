<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>NotebookLM - Curator Page</title>

    <!-- Meta Tags -->
    <meta http-equiv="Content-Security-Policy"
        content="default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval' https: blob:; style-src 'self' 'unsafe-inline' https:; font-src 'self' https: data:; img-src 'self' https: data: blob:; connect-src 'self' https: blob:; worker-src 'self' blob:; child-src 'self' blob:; frame-src 'self' blob:;" />

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@300;400;500;600;700&display=swap"
        rel="stylesheet" />

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Alpine.js with persistence plugin -->
    <script
      type="application/javascript"
      src="https://cdn.jsdelivr.net/npm/@alpinejs/persist@3.x.x/dist/cdn.min.js"
    ></script>
    <!-- ApexCharts -->
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <!-- Alpine JS -->
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.13.3/dist/cdn.min.js" defer></script>

    <!-- PDF.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js" id="pdfjs-script"></script>
    <script>
        // Set worker path after the script loads
        document.addEventListener('DOMContentLoaded', function() {
            if (window.pdfjsLib) {
                window.pdfjsLib.GlobalWorkerOptions.workerSrc =
                    'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.worker.min.js';
            }
        });
    </script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf_viewer.min.css" />

    <!-- App Initialization -->
    <script type="application/javascript">
      document.addEventListener("alpine:init", () => {
        // Store for shared state
        Alpine.store('scroll', {
          // Track scroll state for each column
          scrollStates: {},
          
          // Function to handle scroll position changes
          handleScrollPosition(columnName, isAtBottom) {
            const isMobile = Alpine.store('app').isMobile;
            const screenType = isMobile ? 'mobile' : 'desktop';
            
            // Initialize state for this column if it doesn't exist
            if (this.scrollStates[columnName] === undefined) {
              this.scrollStates[columnName] = { wasAtBottom: false };
            }
            
            const columnState = this.scrollStates[columnName];
            
            // Check if we've crossed the threshold
            if (isAtBottom && !columnState.wasAtBottom) {
              // Just reached the bottom
              console.log(`[${new Date().toISOString()}] Reached bottom of ${columnName} column on ${screenType} view`);
              
              if (isMobile) {
                console.log('Mobile view: Bottom reached - consider showing a "Load More" button');
              } else {
                console.log('Desktop view: Bottom reached - could auto-load more content');
              }
              
            } else if (!isAtBottom && columnState.wasAtBottom) {
              // Just scrolled away from bottom
              console.log(`[${new Date().toISOString()}] Scrolled away from bottom of ${columnName} column on ${screenType} view`);
              
              if (isMobile) {
                console.log('Mobile view: Scrolled up from bottom - might want to hide any bottom action buttons');
              } else {
                console.log('Desktop view: Scrolled up from bottom - could pause any auto-loading');
              }
            }
            
            // Update the state
            columnState.wasAtBottom = isAtBottom;
          }
        });

        // Custom directive to detect scroll position
        Alpine.directive('at-bottom', (el, { expression }, { evaluateLater }) => {
          const handleScroll = () => {
            const isAtBottom = el.scrollHeight - el.scrollTop <= el.clientHeight + 5; // 5px threshold
            
            // Always call the handler with current scroll state
            if (expression) {
              const columnName = expression.replace(/["']/g, ''); // Clean up the column name
              Alpine.store('scroll').handleScrollPosition(columnName, isAtBottom);
              
              // Also execute any additional expression
              Alpine.evaluate(el, expression);
            }
          };
          
          // Initial check
          handleScroll();
          
          // Check on scroll with debounce
          let ticking = false;
          el.addEventListener('scroll', () => {
            if (!ticking) {
              window.requestAnimationFrame(() => {
                handleScroll();
                ticking = false;
              });
              ticking = true;
            }
          });
          
          // Cleanup
          return () => {
            el.removeEventListener('scroll', handleScroll);
          };
        });
        
        // Store for shared state
        Alpine.store("app", {
          activeTab: Alpine.$persist("middle-column"),
          isMobile: window.innerWidth < 1024,
          checkScreenSize() {
            const isMobile = window.innerWidth < 1024;
            console.log('Screen size changed:', isMobile ? 'Mobile' : 'Desktop');
            this.isMobile = isMobile;
            return isMobile;
          }
        });

        // Initial check
        Alpine.store('app').checkScreenSize();

        // Add resize listener
        window.addEventListener('resize', () => {
          Alpine.store('app').checkScreenSize();
        });

        // Global app functions
        window.app = {
          switchTab: function (tabId) {
            // Hide all columns
            document.querySelectorAll(".column").forEach((col) => {
              col.classList.remove("active");
            });

            // Show selected column
            const target = document.getElementById(tabId);
            if (target) {
              target.classList.add("active");
              // Store the full tab ID with -column suffix
              Alpine.store("app").activeTab = tabId;
            }
          },
        };
      });

      // Initialize when DOM is ready
      document.addEventListener("DOMContentLoaded", () => {
        // Set initial tab - ensure it has the -column suffix
        let initialTab = Alpine.store("app").activeTab;
        if (!initialTab.endsWith("-column")) {
          initialTab = "middle-column"; // Default to middle column if format is incorrect
          Alpine.store("app").activeTab = initialTab;
        }
        window.app.switchTab(initialTab);
      });
    </script>

    <!-- Tailwind Configuration -->
    <script
      type="application/javascript"
      src="./js/tailwind-config.js"
    ></script>

    <!-- Custom Scripts -->
  <script src="js/index2.js"></script>
    <script type="application/javascript" src="./js/app.js"></script>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="./css/app.css" />
    <link rel="stylesheet" href="./css/index2.css" />
    <link rel="stylesheet" href="./css/tour.css" />
</head>

<body class="flex flex-col min-h-screen bg-eu-white font-sans text-text-primary" style="--tw-bg-opacity: 1;"
    x-data="{
        preloaderVisible: true,
        profileDropdownOpen: false,
        handleDropdownMenuItemClick(action) {
            this.profileDropdownOpen = false;
            switch (action) {
                case 'profile':
                    window.location.href = './profile.html';
                    break;
                case 'settings':
                    window.location.href = './settings.html';
                    break;
                case 'signout':
                    console.log('Signing out...');
                    // Add sign out logic here
                    break;
            }
        },
        init() {
            // Hide preloader when page is fully loaded
            window.addEventListener('load', () => {
                setTimeout(() => {
                    this.preloaderVisible = false;
                }, 500);
            });
        }
    }" x-init="init()">
    <!-- Preloader -->
    <div id="preloader"
        class="fixed inset-0 z-50 flex items-center justify-center bg-eu-blue transition-opacity duration-500"
        x-show="preloaderVisible" x-transition:enter="transition ease-out duration-300"
        x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100"
        x-transition:leave="transition ease-in duration-300" x-transition:leave-start="opacity-100"
        x-transition:leave-end="opacity-0">
        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-eu-orange" aria-label="Loading"></div>
    </div>
    <!-- Mobile Header (visible on small screens) -->
    <div class="lg:hidden bg-[#003087] shadow-md z-10 w-full">
        <!-- Top Row: Logo and Profile -->
        <div class="flex items-center justify-between px-4 py-3">
            <!-- Logo -->
            <a href="./index.html" class="flex items-center flex-shrink-0">
                <img src="./images/rgb-logo_white_onblue.svg" alt="Logo" class="h-10 w-10" />
                <span class="ml-2 text-white text-base font-bold whitespace-nowrap">
                    Notebook LLM
                </span>
            </a>

            <!-- Profile Button -->
            <div class="relative">
                <button @click.stop="profileDropdownOpen = !profileDropdownOpen" class="p-1 focus:outline-none"
                    aria-expanded="false" aria-haspopup="true">
                    <span class="sr-only">Open user menu</span>
                    <div class="relative">
                        <div class="absolute inset-0 rounded-full transition-all duration-200"
                            :class="{ 'ring-2 ring-eu-orange': profileDropdownOpen, 'ring-2 ring-white': !profileDropdownOpen }">
                        </div>
                        <img class="h-8 w-8 rounded-full"
                            src="https://ui-avatars.com/api/?name=Peter+Thirikwa&background=003087&color=fff&rounded=true&size=40"
                            alt="Profile" />
                    </div>
                </button>

                <!-- Dropdown menu -->
                <div x-show="profileDropdownOpen" @click.away="profileDropdownOpen = false"
                    class="origin-top-right absolute right-0 mt-2 w-56 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 focus:outline-none z-50"
                    role="menu" aria-orientation="vertical" x-transition:enter="transition ease-out duration-100"
                    x-transition:enter-start="transform opacity-0 scale-95"
                    x-transition:enter-end="transform opacity-100 scale-100"
                    x-transition:leave="transition ease-in duration-75"
                    x-transition:leave-start="transform opacity-100 scale-100"
                    x-transition:leave-end="transform opacity-0 scale-95">
                    <div class="py-1" role="none">
                        <div class="px-4 py-3 border-b border-gray-100">
                            <p class="text-xs text-gray-500">Welcome back,</p>
                            <p class="text-sm font-medium text-gray-900 truncate">
                                Peter Thirikwa
                            </p>
                            <p class="text-xs text-gray-500 truncate">peter@rgb.co.tz</p>
                        </div>
                        <a href="#" class="flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"
                            role="menuitem" @click.stop="handleDropdownMenuItemClick('profile')">
                            <i class="fas fa-user-circle w-5 text-center text-eu-blue mr-3"></i>
                            <span>My Profile</span>
                        </a>
                        <a href="#" class="flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"
                            role="menuitem" @click.stop="handleDropdownMenuItemClick('settings')">
                            <i class="fas fa-cog w-5 text-center text-eu-blue mr-3"></i>
                            <span>Settings</span>
                        </a>
                        <div class="border-t border-gray-100 my-1"></div>
                        <a href="#" class="flex items-center px-4 py-2 text-sm text-red-600 hover:bg-red-50"
                            role="menuitem" @click.stop="handleDropdownMenuItemClick('signout')">
                            <i class="fas fa-sign-out-alt w-5 text-center text-red-500 mr-3"></i>
                            <span>Sign out</span>
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Mobile Page Title - Visible in header on mobile -->
        <div class="lg:hidden bg-[#003087] px-4 py-2 relative z-10">
            <h1 class="text-base font-bold text-white text-center">
                Collection #0001 Documents Page
            </h1>
        </div>
    </div>

    <!-- Desktop Header (hidden on mobile) -->
    <header class="hidden lg:flex px-4 py-3 bg-[#003087] shadow-md z-50 w-full fixed top-0 left-0 right-0">
        <div class="flex items-center justify-between w-full">
            <!-- Logo and name on the left -->
            <div class="flex-shrink-0">
                <a href="./index.html" class="flex items-center group">
                    <div class="relative">
                        <img src="./images/rgb-logo_white_onblue.svg" alt="Logo"
                            class="h-10 w-10 lg:h-12 lg:w-12 rounded-full transform transition-transform duration-300 group-hover:rotate-12" />
                        <div
                            class="absolute inset-0 rounded-full border-2 border-transparent group-hover:border-eu-orange transition-all duration-300">
                        </div>
                    </div>
                    <span
                        class="ml-3 text-eu-white text-lg lg:text-xl font-semibold transition-colors duration-200 hover:text-eu-orange">
                        Notebook LLM
                    </span>
                </a>
            </div>

            <!-- Title in the center with hover effect -->
            <div class="flex-1 flex justify-center px-4">
                <h1
                    class="text-xl lg:text-2xl font-bold text-eu-white whitespace-nowrap transition-all duration-300 transform hover:scale-105 hover:text-eu-orange">
                    Collection #0001 Documents Page
                </h1>
            </div>

            <!-- Icons and profile on the right -->
            <div class="flex items-center space-x-6">
                <div class="flex items-center space-x-5">
                    <a href="./index.html" class="text-eu-white hover:text-eu-orange transition-colors" title="Home">
                        <i class="fas fa-home text-xl"></i>
                    </a>
                    <button class="text-eu-white hover:text-eu-orange transition-colors" title="Help">
                        <i class="fas fa-question-circle text-xl"></i>
                    </button>
                    <button class="text-eu-white hover:text-eu-orange transition-colors relative"
                        title="Notifications">
                        <i class="fas fa-bell text-xl"></i>
                        <span class="absolute -top-1 -right-1 h-2 w-2 rounded-full bg-eu-orange"></span>
                    </button>
                </div>

                <!-- Profile dropdown -->
                <div class="relative">
                    <button @click.stop="profileDropdownOpen = !profileDropdownOpen"
                        class="p-1 focus:outline-none group" :class="{ 'ring-2 ring-eu-orange': profileDropdownOpen }">
                        <div class="relative">
                            <!-- Background circle with hover/active states -->
                            <div class="relative h-10 w-10 flex items-center justify-center">
                                <!-- Hover background -->
                                <div
                                    class="absolute inset-0 rounded-full bg-eu-orange/0 group-hover:bg-eu-orange/10 transition-colors duration-200">
                                </div>

                                <!-- Active state background -->
                                <div class="absolute inset-0 rounded-full transition-opacity duration-200"
                                    :class="{ 'bg-eu-orange/20': profileDropdownOpen }"></div>

                                <!-- Border ring -->
                                <div class="absolute inset-0 rounded-full ring-1 ring-white/50 group-hover:ring-2 group-hover:ring-eu-orange transition-all duration-200"
                                    :class="{ 'ring-2 ring-eu-orange': profileDropdownOpen }"></div>

                                <!-- Profile image -->
                                <img src="https://ui-avatars.com/api/?name=Peter+Thirikwa&background=003087&color=fff&rounded=true&size=40"
                                    class="h-8 w-8 rounded-full object-cover transition-transform duration-200 group-hover:scale-105"
                                    alt="Profile" />
                            </div>
                        </div>
                    </button>

                    <!-- Dropdown menu -->
                    <div x-show="profileDropdownOpen" @click.away="profileDropdownOpen = false"
                        class="absolute right-0 mt-2 w-64 bg-white rounded-lg shadow-xl z-50 border border-eu-blue/10 overflow-hidden"
                        x-transition:enter="transition ease-out duration-100"
                        x-transition:enter-start="transform opacity-0 scale-95"
                        x-transition:enter-end="transform opacity-100 scale-100"
                        x-transition:leave="transition ease-in duration-75"
                        x-transition:leave-start="transform opacity-100 scale-100"
                        x-transition:leave-end="transform opacity-0 scale-95">
                        <!-- Welcome Message -->
                        <div class="px-4 py-3 border-b border-gray-100">
                            <p class="text-xs text-gray-500 mb-1">Welcome back,</p>
                            <p class="text-sm font-medium text-gray-900 truncate">
                                Peter Thirikwa
                            </p>
                            <p class="text-xs text-gray-500 truncate">peter@rgb.co.tz</p>
                        </div>

                        <!-- Menu Items -->
                        <div class="py-1" role="menu" aria-orientation="vertical">
                            <a href="#"
                                class="flex items-center px-4 py-2.5 text-sm text-gray-700 hover:bg-gray-50 transition-colors"
                                role="menuitem" @click.stop="handleDropdownMenuItemClick('profile')">
                                <i class="fas fa-user-circle w-5 text-center text-eu-blue mr-3"></i>
                                <span>My Profile</span>
                            </a>
                            <a href="#"
                                class="flex items-center px-4 py-2.5 text-sm text-gray-700 hover:bg-gray-50 transition-colors"
                                role="menuitem" @click.stop="handleDropdownMenuItemClick('settings')">
                                <i class="fas fa-cog w-5 text-center text-eu-blue mr-3"></i>
                                <span>Settings</span>
                            </a>
                            <div class="border-t border-gray-100 my-1"></div>
                            <a href="#"
                                class="flex items-center px-4 py-2.5 text-sm font-medium text-red-500 hover:bg-red-50 hover:text-red-600 transition-colors"
                                role="menuitem" @click.stop="handleDropdownMenuItemClick('signout')">
                                <i class="fas fa-sign-out-alt w-5 text-center mr-3"></i>
                                <span>Sign out</span>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content Container -->
    <main class="flex-1 overflow-y-auto lg:pt-16">
        <!-- <div class="container mx-auto max-w-7xl pt-10 px-4"> -->
        <div class="container mx-auto w-full pt-10 px-4">
            <!-- Welcome Message -->
            <section class="mb-10">
                <div class="mb-2">
                    <h2 class="text-3xl md:text-4xl font-extrabold text-eu-orange leading-tight mb-4"
                        style="font-family: Rubik, sans-serif">
                        Collection #0001 Documents
                    </h2>
                </div>
                <div class="max-w-full md:max-w-[70%]">
                    <p class="text-base lg:text-lg text-text-secondary"
                        style="font-family: Rubik, sans-serif; line-height: 1.75">
                        Create AI-powered study guides from your documents. Upload
                        sources, ask questions, and get answers backed by your content.
                        Work more efficiently by leveraging the power of AI to summarize
                        long documents, extract key concepts, and identify relevant
                        information quickly.
                    </p>
                </div>
            </section>

            <!-- Action Bar -->
            <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
                <!-- Left section - Upload Button -->
                <div class="w-full sm:w-auto">
                    <button
                        class="create-button flex items-center justify-center sm:justify-start gap-3 px-6 py-2 md:px-8 font-semibold text-base sm:text-lg shadow-lg bg-eu-blue text-eu-white rounded-full hover:bg-eu-orange transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-eu-blue focus:ring-offset-2 scale-100 hover:scale-105 active:scale-100 w-full sm:w-auto h-12"
                        onclick="document.getElementById('uploadDocumentModal').classList.remove('hidden'); document.body.style.overflow = 'hidden';">
                        <span class="w-6 h-6 flex-shrink-0 flex items-center justify-center rounded-full bg-white/20">
                            <i class="fas fa-plus text-white text-sm"></i>
                        </span>
                        <span>Upload Documents</span>
                    </button>
                </div>

                <!-- Right section - View Toggle and Sort -->
                <div class="flex items-center justify-end space-x-2 w-full sm:w-auto">

                <!-- View Options - moved to the right -->
                <div class="view-toggle flex items-center h-12">
                    <div class="flex rounded-full bg-eu-white border border-eu overflow-hidden h-10">
                        <button id="taxonomy-edit-btn"
                            class="px-4 py-2 h-10 bg-eu-white text-eu-blue hover:bg-eu-orange hover:text-eu-white focus:outline-none border-r border-eu/20"
                            onclick="toggleTaxonomyModal()" type="button" title="Edit Taxonomy">
                            <i class="fas fa-cog"></i>
                        </button>
                        <button id="grid-view-btn"
                            class="px-4 py-2 h-10 bg-eu-white text-eu-blue hover:bg-eu-orange hover:text-eu-white focus:outline-none border-r border-eu/20"
                            onclick="setViewMode('grid')" type="button" title="Grid View">
                            <i class="fas fa-th-large"></i>
                        </button>
                        <button id="list-view-btn"
                            class="px-4 py-2 h-10 bg-eu-orange text-eu-white focus:outline-none"
                            onclick="setViewMode('list')" type="button" title="List View">
                            <i class="fas fa-list"></i>
                        </button>
                    </div>
                </div>

                <!-- Sort Dropdown - moved to the right -->
                <div class="relative h-10">
                    <button class="flex items-center justify-center sm:justify-start space-x-1 sm:space-x-2 px-3 py-2 rounded-full bg-eu-white border border-eu hover:bg-eu-orange hover:text-eu-white focus:outline-none text-eu-blue h-10 w-10 sm:w-auto cursor-pointer" onclick="toggleDropdown(event)" type="button" title="Sort">
                        <i class="fas fa-sort-amount-down text-sm"></i>
                        <span id="sort-label" class="hidden sm:inline pointer-events-none">Sort</span>
                    </button>
                    <div id="sort-menu" class="dropdown-menu absolute right-0 mt-2 bg-eu-white border border-eu rounded shadow-lg hidden z-50 min-w-[180px]">
                        <a href="#" class="block px-4 py-2 text-sm text-eu-blue hover:bg-eu-orange hover:text-eu-white" onclick="setSort('recent')">Most recent</a>
                        <a href="#" class="block px-4 py-2 text-sm text-eu-blue hover:bg-eu-orange hover:text-eu-white" onclick="setSort('name')">Name (A-Z)</a>
                        <a href="#" class="block px-4 py-2 text-sm text-eu-blue hover:bg-eu-orange hover:text-eu-white" onclick="setSort('modified')">Last modified</a>
                    </div>
                </div>
            </div>
            </div>

            <!-- List View (Default) -->
            <div id="list-view">
                <!-- Content will be dynamically generated by JavaScript -->
            </div>

            <!-- Grid View (Hidden) -->
            <div id="grid-view" class="hidden">
                <!-- Content will be dynamically generated by JavaScript -->
            </div>
        </div>
    </main>

    <!-- Footer with Disclaimer -->
    <footer class="py-3">
        <p class="text-center text-xs text-gray-500">
            NotebookLM can be inaccurate; please double-check its responses.
        </p>
    </footer>
    
    <!-- Upload Document Modal -->
    <div id="uploadDocumentModal" class="hidden fixed inset-0 z-[100] overflow-hidden">
        <div class="absolute inset-0 bg-black bg-opacity-50 backdrop-blur-sm" id="uploadDocumentBackdrop"
            style="cursor: pointer"></div>
        <div class="fixed inset-0 flex items-center justify-center p-4">
            <div class="bg-white rounded-lg shadow-2xl w-full max-w-[90vw] h-[80vh] flex flex-col overflow-hidden">
                <!-- Header with Logo and App Name -->
                <div class="bg-eu-blue px-6 py-4 rounded-t-lg flex justify-between items-center">
                    <div class="flex items-center">
                        <img src="./images/rgb-logo_white_onblue.svg" alt="Logo" class="h-8 w-8" />
                        <span class="ml-2 text-white text-lg font-bold whitespace-nowrap">
                            Notebook LLM
                        </span>
                    </div>
                    <button id="closeUploadModal" class="text-white hover:text-eu-orange hover:bg-eu-orange/10 rounded-full p-2 focus:outline-none"
                        onclick="closeUploadModal()">
                        <i class="fas fa-times text-2xl"></i>
                    </button>
                </div>

                <!-- Content Area -->
                <div class="p-6 flex-1 flex flex-col overflow-hidden">
                    <div class="mb-6">
                        <h3 class="text-lg font-normal text-gray-700 mb-1">Upload Documents</h3>
                        <p class="text-sm text-gray-600">
                            Sources let NotebookLM base its responses on the information that matters most to you.
                            <br>
                            (Examples: marketing plans, course reading, research notes, meeting transcripts, sales documents, etc.)
                        </p>
                    </div>
                    <div class="flex-1 flex flex-col">
                        <div id="dropZone"
                            class="flex-1 border-2 border-dashed border-gray-300 rounded-lg p-8 text-center cursor-pointer hover:border-eu-orange transition-colors duration-200 flex flex-col items-center justify-center">
                            <div class="space-y-4 max-w-md">
                                <div class="mx-auto w-16 h-16 bg-eu-blue/10 rounded-full flex items-center justify-center">
                                    <i class="fas fa-upload text-2xl text-eu-blue"></i>
                                </div>
                                <h3 class="text-lg font-medium text-gray-900">Upload Sources</h3>
                                <h3 class="text-sm text-gray-500">Drag and drop or click the select files button below to files</h3>
                                <p class="text-xs text-gray-500">Supported file types: PDF, txt, Markdown, Audio (e.g. mp3)</p>
                                <label class="inline-flex items-center px-4 py-1.5 bg-eu-orange text-white rounded-full hover:bg-eu-orange/90 cursor-pointer transition-colors duration-200 font-medium">
                                    Select Files
                                    <input type="file" id="fileInput" class="hidden" multiple>
                                </label>
                            </div>
                        </div>

                        <!-- Document Count Progress -->
                        <div class="mt-6">
                            <div class="flex justify-between text-sm text-gray-600 mb-2">
                                <span>Source Limits: <span id="documentCount">0</span>/50</span>
                                <span id="storagePercentage">0%</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2.5">
                                <div id="storageProgress" class="bg-eu-orange h-2.5 rounded-full transition-all duration-200 hover:bg-eu-orange/90 cursor-pointer" style="width: 0%"></div>
                            </div>
                        </div>

                        <!-- Selected Files List -->
                        <div id="selectedFiles" class="mt-4 space-y-2 max-h-40 overflow-y-auto">
                            <!-- Files will be listed here -->
                        </div>
                    </div>
                </div>

                <!-- Footer -->
                <div class="bg-gray-50 border-t border-gray-200 px-6 py-4 rounded-b-lg flex justify-end space-x-3">
                    <button id="cancelUpload"
                        class="px-6 py-2.5 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-full hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-eu-orange"
                        onclick="closeUploadModal()">
                        Cancel
                    </button>
                    <button id="confirmUpload"
                        class="px-6 py-2.5 text-sm font-medium text-white bg-eu-orange border border-transparent rounded-full hover:bg-eu-orange/90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-eu-orange">
                        Upload Files
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Taxonomy Edit Modal -->
    <div id="taxonomyModal" class="hidden fixed inset-0 z-[100] overflow-hidden">
        <div class="absolute inset-0 bg-black bg-opacity-50 backdrop-blur-sm" id="taxonomyBackdrop"></div>
        <div class="fixed inset-0 flex items-center justify-center p-4">
            <div class="bg-white rounded-lg shadow-2xl w-full max-w-[90vw] h-[80vh] flex flex-col overflow-hidden">
                <!-- Header with Logo and App Name -->
                <div class="bg-eu-blue px-6 py-4 rounded-t-lg flex justify-between items-center">
                    <div class="flex items-center">
                        <img src="./images/rgb-logo_white_onblue.svg" alt="Logo" class="h-8 w-8" />
                        <span class="ml-2 text-white text-lg font-bold whitespace-nowrap">
                            Notebook LLM
                        </span>
                    </div>
                    <button id="closeTaxonomyModal" class="text-white hover:text-eu-orange hover:bg-eu-orange/10 rounded-full p-2 focus:outline-none"
                        onclick="closeTaxonomyModal()">
                        <i class="fas fa-times text-2xl"></i>
                    </button>
                </div>

                <!-- Content -->
                <div class="flex flex-col flex-1 overflow-hidden">
                    <div class="p-6 flex-1 flex flex-col overflow-hidden">
                        <!-- Add Category -->
                        <div class="space-y-2 mb-6">
                            <label for="newCategory" class="block text-sm font-medium text-gray-700 mb-1">Add New Category</label>
                            <p class="text-sm text-gray-600 mb-3">
                                Categories help organize your documents into meaningful groups.
                                <span class="text-xs text-gray-500">(Examples: Project Phases, Document Types, Departments, etc.)</span>
                            </p>
                            <div class="flex space-x-2">
                                <input type="text" id="newCategory" 
                                       class="flex-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                       placeholder="Enter category name">
                                <button id="addCategory" 
                                    class="px-4 py-2 bg-eu-blue/90 text-white hover:bg-eu-orange hover:text-white focus:outline-none focus:ring-2 focus:ring-eu-orange focus:ring-offset-2 rounded-full transition-colors duration-200 group"
                                    title="Add New Category">
                                    <i class="fas fa-plus text-lg group-hover:text-white"></i>
                                </button>
                            </div>
                            <button type="button" id="toggleConfigBtn" class="text-xs text-blue-600 hover:text-blue-800 flex items-center group">
                                <i id="configChevron" class="fas fa-chevron-down text-lg text-blue-700 transition-transform duration-200 group-data-[expanded=true]:rotate-180 mr-2"></i>
                                <span>Add configuration (optional)</span>
                            </button>
                            <div id="categoryConfigContainer" class="hidden mt-2">
                                <label for="categoryConfig" class="block text-sm font-medium text-gray-700 mb-1">Configuration (JSON)</label>
                                <p class="text-sm text-gray-600 mb-3">
                                    Define advanced settings for this category using JSON format.
                                    <span class="text-xs text-gray-500">(Example: {"color": "#3b82f6", "icon": "folder", "required": true})</span>
                                </p>
                                <textarea id="categoryConfig" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 font-mono text-sm h-32" placeholder='{"color": "#3b82f6", "icon": "folder"}'></textarea>
                            </div>
                        </div>

                        <!-- Categories List -->
                        <div class="flex-1 flex flex-col overflow-hidden">
                            <div class="flex items-center justify-between mb-2">
                                <h4 class="text-sm font-medium text-gray-700">Your Categories</h4>
                                <span id="categoryCount" class="text-xs text-blue-800">0 categories</span>
                            </div>
                            <p class="text-sm text-gray-600 mb-3">
                                Organize your documents with custom categories. 
                                <span class="text-xs text-gray-500">(Click on a category to edit or manage its settings)</span>
                            </p>
                            <div class="flex-1 min-h-0 pb-2">
                                <div id="categoriesList" class="space-y-2 h-full max-h-[calc(100vh-420px)] overflow-y-auto p-2 border border-gray-200 rounded-md">
                                    <div class="text-sm text-gray-500 italic text-center py-4">No categories added yet</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- JSON Viewer -->
                    <div id="jsonViewer" class="border-t border-gray-200 bg-white hidden flex flex-col" style="flex: 0 0 auto;">
                        <div class="bg-gray-50 px-4 py-2 border-b border-gray-200 flex justify-between items-center">
                            <span class="text-sm font-medium text-gray-700">Configuration</span>
                            <button id="closeJsonViewer" class="text-gray-400 hover:text-gray-500">
                                <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                                </svg>
                            </button>
                        </div>
                        <div class="flex-1 min-h-0 overflow-hidden">
                            <pre id="jsonContent" class="p-4 text-sm font-mono overflow-auto h-full max-h-[300px]"></pre>
                        </div>
                    </div>
                </div>

                <!-- Footer -->
                <div class="bg-gray-50 border-t border-gray-200 px-6 py-4 rounded-b-lg flex justify-end space-x-3">
                    <button id="cancelTaxonomyChanges"
                        class="px-6 py-2.5 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-full hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-eu-orange"
                        onclick="closeTaxonomyModal()">
                        Cancel
                    </button>
                    <button id="saveTaxonomyChanges"
                        class="px-6 py-2.5 text-sm font-medium text-white bg-eu-orange border border-transparent rounded-full hover:bg-eu-orange/90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-eu-orange">
                        Save Changes
                    </button>
                </div>

            </div>
        </div>
    </div>

    <!-- Rename Document Modal -->
    <div id="renameDocumentModal" class="hidden fixed inset-0 z-[100] overflow-hidden">
        <div class="absolute inset-0 bg-black bg-opacity-50 backdrop-blur-sm" id="renameDocumentBackdrop"></div>
        <div class="fixed inset-0 flex items-center justify-center p-4">
            <div class="bg-white rounded-lg shadow-2xl w-full max-w-5xl flex flex-col overflow-hidden">
                <!-- Header with Logo and App Name -->
                <div class="bg-eu-blue px-6 py-4 rounded-t-lg flex justify-between items-center">
                    <div class="flex items-center">
                        <img src="./images/rgb-logo_white_onblue.svg" alt="Logo" class="h-8 w-8" />
                        <span class="ml-2 text-white text-lg font-bold whitespace-nowrap">
                            Notebook LLM
                        </span>
                    </div>
                    <button id="closeRenameModal" class="text-white hover:text-eu-orange hover:bg-eu-orange/10 rounded-full p-2 focus:outline-none"
                        onclick="closeRenameModal()">
                        <i class="fas fa-times text-2xl"></i>
                    </button>
                </div>

                <!-- Content -->
                <div class="p-6 flex-1">
                    <div class="space-y-4">
                        <div>
                            <label for="newDocumentName" class="block text-sm font-medium text-gray-700 mb-1">Document Name</label>
                            <p class="text-sm text-gray-600 mb-3">
                                Enter a new name for your document. 
                                <span class="text-xs text-gray-500">(Example: "Q3_Report_Final", "Project_Proposal_v2", etc.)</span>
                            </p>
                            <input type="text" id="newDocumentName" 
                                class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 sm:text-sm" 
                                placeholder="Enter new document name">
                            <p class="mt-2 text-xs text-gray-500">
                                Tip: Use a clear, descriptive name that will help you easily identify this document later.
                            </p>
                            <input type="hidden" id="currentDocumentId">
                        </div>
                    </div>
                </div>

                <!-- Footer -->
                <div class="bg-gray-50 border-t border-gray-200 px-6 py-4 rounded-b-lg flex justify-end space-x-3">
                    <button type="button" class="close-rename-modal px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-eu-orange">
                        Cancel
                    </button>
                    <button type="button" id="confirmRenameDocument" class="px-4 py-2 text-sm font-medium text-white bg-eu-orange border border-transparent rounded-md hover:bg-eu-orange-dark focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-eu-orange transition-colors">
                        Rename
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete Document Modal -->
    <div id="deleteDocumentModal" class="hidden fixed inset-0 z-[100] overflow-hidden">
        <div class="absolute inset-0 bg-black bg-opacity-50 backdrop-blur-sm" id="deleteDocumentBackdrop"></div>
        <div class="fixed inset-0 flex items-center justify-center p-4">
            <div class="bg-white rounded-lg shadow-2xl w-full max-w-5xl flex flex-col overflow-hidden">
                <!-- Header with Logo and App Name -->
                <div class="bg-eu-blue px-6 py-4 rounded-t-lg flex justify-between items-center">
                    <div class="flex items-center">
                        <img src="./images/rgb-logo_white_onblue.svg" alt="Logo" class="h-8 w-8" />
                        <span class="ml-2 text-white text-lg font-bold whitespace-nowrap">
                            Notebook LLM
                        </span>
                    </div>
                    <button id="closeDeleteModal" class="text-white hover:text-eu-orange hover:bg-eu-orange/10 rounded-full p-2 focus:outline-none"
                        onclick="closeDeleteModal()">
                        <i class="fas fa-times text-2xl"></i>
                    </button>
                </div>

                <!-- Content -->
                <div class="p-6 flex-1">
                    <div class="space-y-5 text-center">
                        <div class="mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-red-100">
                            <i class="fas fa-exclamation-triangle text-red-600 text-2xl"></i>
                        </div>
                        <div>
                            <h3 class="text-lg font-semibold text-gray-900">Confirm Deletion</h3>
                            <div class="mt-3 space-y-2">
                                <p class="text-sm text-gray-600">
                                    You are about to delete: <br>
                                    <span id="documentToDelete" class="font-medium text-red-600 break-all"></span>
                                </p>
                                <p class="text-xs text-gray-500 mt-2">
                                    <i class="fas fa-exclamation-circle mr-1"></i>
                                    This action is permanent and cannot be undone.
                                </p>
                            </div>
                        </div>
                    </div>
                    <input type="hidden" id="documentIdToDelete">
                </div>

                <!-- Footer -->
                <div class="bg-gray-50 border-t border-gray-200 px-6 py-4 rounded-b-lg flex justify-end space-x-3">
                    <button type="button" class="close-delete-modal px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-eu-orange">
                        Cancel
                    </button>
                    <button type="button" id="confirmDeleteDocument" class="px-4 py-2 text-sm font-medium text-white bg-eu-orange border border-transparent rounded-md hover:bg-eu-orange-dark focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-eu-orange transition-colors">
                        Delete Permanently
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
    
</body>

</html>
